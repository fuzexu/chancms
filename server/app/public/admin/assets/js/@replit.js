import{V as t,F as e,c as n,E as i,g as s,D as r,R as o}from"./@codemirror.js";function c(t){const e=t.selection.main.head;return t.doc.lineAt(e)}function a(t,e){let n=0;t:for(let i=0;i<t.length;i++)switch(t[i]){case" ":case"Â ":n+=1;continue t;case"\t":n+=e-n%e;continue t;case"\r":continue t;default:break t}return n}const l=e.define({combine:t=>n(t,{highlightActiveBlock:!0,hideFirstIndent:!1,markerType:"fullScope",thickness:1})});class h{constructor(t,e,n,i){this.lines=t,this.state=e,this.map=new Map,this.unitWidth=n,this.markerType=i;for(const s of this.lines)this.add(s);this.state.facet(l).highlightActiveBlock&&this.findAndSetActiveLines()}has(t){return this.map.has("number"==typeof t?t:t.number)}get(t){const e=this.map.get("number"==typeof t?t:t.number);if(!e)throw new Error("Line not found in indentation map");return e}set(t,e,n){const i=!t.text.trim().length,s={line:t,col:e,level:n,empty:i};return this.map.set(s.line.number,s),s}add(t){if(this.has(t))return this.get(t);if(!t.length||!t.text.trim().length){if(1===t.number)return this.set(t,0,0);if(t.number===this.state.doc.lines){const e=this.closestNonEmpty(t,-1);return this.set(t,0,e.level)}const e=this.closestNonEmpty(t,-1),n=this.closestNonEmpty(t,1);return e.level>=n.level&&"codeOnly"!==this.markerType?this.set(t,0,e.level):e.empty&&0===e.level&&0!==n.level?this.set(t,0,0):n.level>e.level?this.set(t,0,e.level+1):this.set(t,0,n.level)}const e=a(t.text,this.state.tabSize),n=Math.floor(e/this.unitWidth);return this.set(t,e,n)}closestNonEmpty(t,e){let n=t.number+e;for(;-1===e?n>=1:n<=this.state.doc.lines;){if(this.has(n)){const t=this.get(n);if(!t.empty)return t}const t=this.state.doc.line(n);if(t.text.trim().length){const e=a(t.text,this.state.tabSize),n=Math.floor(e/this.unitWidth);return this.set(t,e,n)}n+=e}const i=this.state.doc.line(-1===e?1:this.state.doc.lines);return this.set(i,0,0)}findAndSetActiveLines(){const t=c(this.state);if(!this.has(t))return;let e,n,i=this.get(t);if(this.has(i.line.number+1)){const t=this.get(i.line.number+1);t.level>i.level&&(i=t)}if(this.has(i.line.number-1)){const t=this.get(i.line.number-1);t.level>i.level&&(i=t)}if(0!==i.level){for(i.active=i.level,e=i.line.number;e>1;e--){if(!this.has(e-1))continue;const t=this.get(e-1);if(t.level<i.level)break;t.active=i.level}for(n=i.line.number;n<this.state.doc.lines;n++){if(!this.has(n+1))continue;const t=this.get(n+1);if(t.level<i.level)break;t.active=i.level}}}}function u(t){const e={light:"#F0F1F2",dark:"#2B3245",activeLight:"#E4E5E6",activeDark:"#3C445C"};let n=e;return t&&(n=Object.assign(Object.assign({},e),t)),i.baseTheme({"&light":{"--indent-marker-bg-color":n.light,"--indent-marker-active-bg-color":n.activeLight},"&dark":{"--indent-marker-bg-color":n.dark,"--indent-marker-active-bg-color":n.activeDark},".cm-line":{position:"relative"},".cm-indent-markers::before":{content:'""',position:"absolute",top:0,left:"2px",right:0,bottom:0,background:"var(--indent-markers)",pointerEvents:"none",zIndex:"-1"}})}function d(t,e,n,i,s){const r="repeating-linear-gradient(to right, var(".concat(t,") 0 ").concat(e,"px, transparent ").concat(e,"px ").concat(n,"ch)");return"".concat(r," ").concat(i*n,".5ch/calc(").concat(n*s,"ch - 1px) no-repeat")}function m(t,e,n,i,s){const{level:r,active:o}=t;if(s=null!=s?s:i,n&&0===r)return[];const c=n?1:0,a=[];if(void 0!==o){const t=o-c-1;t>0&&a.push(d("--indent-marker-bg-color",i,e,c,t)),a.push(d("--indent-marker-active-bg-color",s,e,o-1,1)),o!==r&&a.push(d("--indent-marker-bg-color",i,e,o,r-o))}else a.push(d("--indent-marker-bg-color",i,e,c,r-c));return a.join(",")}class f{constructor(t){this.view=t,this.unitWidth=s(t.state),this.currentLineNumber=c(t.state).number,this.generate(t.state)}update(t){const e=s(t.state),n=e!==this.unitWidth;n&&(this.unitWidth=e);const i=c(t.state).number,r=i!==this.currentLineNumber;this.currentLineNumber=i;const o=t.state.facet(l).highlightActiveBlock&&r;(t.docChanged||t.viewportChanged||n||o)&&this.generate(t.state)}generate(t){const e=new o,n=function(t,e=t.state){const n=new Set;for(const{from:i,to:s}of t.visibleRanges){let t=i;for(;t<=s;){const i=e.doc.lineAt(t);n.has(i)||n.add(i),t=i.to+1}}return n}(this.view,t),{hideFirstIndent:i,markerType:s,thickness:c,activeThickness:a}=t.facet(l),u=new h(n,t,this.unitWidth,s);for(const o of n){const t=u.get(o.number);if(!(null==t?void 0:t.level))continue;const n=m(t,this.unitWidth,i,c,a);e.add(o.from,o.from,r.line({class:"cm-indent-markers",attributes:{style:"--indent-markers: ".concat(n)}}))}this.decorations=e.finish()}}function v(e={}){return[l.of(e),u(e.colors),t.fromClass(f,{decorations:t=>t.decorations})]}export{v as i};
