import{I as e,w as t,i as a,a1 as o,a6 as n,z as l,o as i,c as r,a as s,V as d,W as c,O as u}from"./@vue.js";const p=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),m=()=>{const e="undefined"!=typeof window?window:global;return e&&"tinymce"in e?e.tinymce:null};function _(e){return e?e.getContent():""}function g(e,t){t&&t.setContent(e)}function x(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function f(e,t,a){return new Promise(((o,n)=>{let l,i,{images_upload_url:r,images_upload_credentials:s,custom_images_upload_header:d,custom_images_upload_param:c,custom_images_upload_callback:u,custom_images_limit_size:p}=e||{};if(p&&t.blob().size>p){let e="图片大小不能超过 ".concat(p/1024,"KB");n(e)}else l=new XMLHttpRequest,l.withCredentials=!!s,l.open("POST",r||""),d&&Object.keys(d).forEach((e=>{l.setRequestHeader(e,d[e])})),l.upload.onprogress=function(e){a(e.loaded/e.total*100)},l.onload=function(){if(403===l.status)return void n({message:"HTTP Error: "+l.status,remove:!0});if(l.status<200||l.status>=300)return void n("HTTP Error: "+l.status);let e=JSON.parse(l.responseText);if(!e)return void n("Invalid JSON: "+l.responseText);let t="function"==typeof u?u(e):e.location;t?o(t):n("Failed Path: location image path is error/empty")},l.onerror=function(){n("Image upload failed due to a XHR Transport error. Code: "+l.status)},i=new FormData,i.append("file",t.blob(),t.filename()),c&&Object.keys(c).forEach((e=>{i.append(e,c[e])})),l.send(i)}))}const b=(()=>{let e={status:{},loadedCallbacks:{}};const t=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(a,o,n)=>{o&&(e.loadedCallbacks[a]||(e.loadedCallbacks[a]=[]),e.loadedCallbacks[a].push({handler:o,scope:n||void 0})),"LOADED"!==e.status[a]?"LOADING"!==e.status[a]&&(e.status[a]="LOADING",((e,t)=>{const a=document.createElement("script");a.id=p("tiny-script"),a.type="application/javascript",a.src=e,a.referrerPolicy="origin";const o=()=>{a.removeEventListener("load",o),t()};a.addEventListener("load",o),(document.head||document.body).appendChild(a)})(a,(()=>{e.status[a]="LOADED",t(a)}))):t(a)}}})(),v=["id"],h={key:0},y={name:"Vue3Tinymce"},k=Object.assign(y,{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(y,{expose:k,emit:C}){const w=y,j=C;let z=!0;const O=e({editor:null,id:p("tinymce"),err:""}),S=()=>{var e;return String(null!=(e=w.modelValue)?e:"")},T=(e,t,a)=>{w.debug&&console.log("来自：".concat(e.type," | \n ").concat(t," \n ").concat(a||"--"))},E=(e,t)=>{t||(t=O.editor);const a=_(t);T(e,a),j("update:modelValue",a),j("change",a)},D=()=>{var e;if(null===m())return void(O.err="tinymce is null");w.debug&&console.warn("vue3-tinymce 进入debug模式");let t={...w.setting,selector:"#".concat(O.id),content_style:(a=null==(e=w.setting)?void 0:e.content_style,"body{font-size: 14px;} img{padding: 0 2px;} "+(a||"")),setup:e=>{O.editor=e,w.setup&&w.setup(e),e.on("init",(()=>(e=>{g(S(),e),w.disabled&&"readonly"!==e.mode.get()&&x(e),e.on("change input undo redo",(t=>{E(t,e)})),j("init",e)})(e)))}};var a;w.setting.custom_images_upload&&(t.images_upload_handler=(...e)=>f.apply(null,[w.setting,...e])),m().init(t),z=!1};return t((()=>w.modelValue),((e,t)=>{if(O.editor&&O.editor.initialized&&t!==e&&e!==_(O.editor)){if(T({type:"propsChanged to setContent"},e,t),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent(e);t.setContent(e),t.setDirty(!1),t.undoManager.clear()}}("",O.editor);g(S(),O.editor)}})),t((()=>w.disabled),(e=>{O.editor&&O.editor.initialized&&x(O.editor,e)})),k({id:O.id,editor:O.editor}),a((()=>{var e;if(null!==m())return void D();const t=null!=(e=w.scriptSrc)?e:"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js";b.load(t,D)})),o((()=>{z||D()})),n((()=>{var e;O.editor&&(null==(e=m())||e.remove("#".concat(O.id)))})),l((()=>{var e;O.editor&&(null==(e=m())||e.remove("#".concat(O.id)))})),(e,t)=>(i(),r(u,null,[s("div",{id:O.id,class:"tiny-textarea"},null,8,v),O.err?(i(),r("p",h,d(O.err),1)):c("",!0)],64))}});let C={convert_urls:!1,custom_images_upload:!0,images_upload_url:"/api/upload",custom_images_limit_size:204800,branding:!1,menubar:!0,body_class:"article-content ",object_resizing:!0,paste_data_images:!0,paste_merge_formats:!0,end_container_on_empty_block:!0,powerpaste_word_import:"clean",advlist_bullet_styles:"default,circle,disc,square",advlist_number_styles:"default,lower-alpha,lower-greek,lower-roman,upper-alpha,upper-roman",default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,custom_images_upload_callback:e=>{if(200===e.code)return e.data.path},images_upload_credentials:!0,custom_images_upload_header:{"X-Token":"xxxx"},custom_images_upload_param:{},height:550,toolbar:"undo redo|bold forecolor backcolor fontsize | numlist bullist | alignleft aligncenter alignright | code codesample link unlink |image media table | blocks italic underline strikethrough alignjustify  | indent outdent | superscript subscript | removeformat | fullscreen preview",toolbar_mode:"sliding",quickbars_selection_toolbar:"removeformat | bold italic underline strikethrough | fontsize forecolor backcolor",plugins:"link image media table lists fullscreen quickbars codesample preview code fullscreen",font_size_formats:"12px 13px 14px 15px 16px 17px 18px 19px 20px 21px 22px 23px 24px 25px 26px 27px 28px 29px 30px 31px 32px 33px 34px 35px 36px 37px 38px 39px 40px 41px 42px 43px 44px 45px 46px 37px 48px 49px 50px 51px 52px",link_default_target:"_blank",allow_html_in_named_anchor:!0,valid_children:"+div[p],+div[style]",language:"zh-Hans",language_url:"/public/admin/tinymce/zh-Hans.js",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"PHP",value:"php"},{text:"Ruby",value:"ruby"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"C++",value:"cpp"}],extended_valid_elements:"a[referrerpolicy|href|target|title|class|id|style],img[referrerpolicy|src|alt|width|height|class|id|style]"};export{k as _,C as t};
